/*!
 * C4Design Library v2.0
 * 
 * Author: dakun.ni@cn.pwc.com 
 *
 * Date: 2017-04-06
 */
(function(g){var e={};g.fn.C4Design=e;e.Filed=function(p){var q={};console.log(p);q.value=function(r){if(r){return c(p,r)}else{return f(p)}};q.validation=function(r){return d(p,null,r)};q.empty=function(){return o(p)};q.type=function(){return n(p)};return q};e.Filed.getValue=function(p){return f(p)};e.Section=function(p){console.log("C4Design")};e.Html=function(p){console.log("C4Design")};e.Document=function(q){var p={};p.status=j();return p};function l(p){g(p).each(function(r,q){i(f(q.item),q.showSection,q.innerItem,false);if(PageMode!="preview"){a(q.item).change(function(){i(g(this).val(),q.showSection,q.innerItem,true)})}if(q.hasOwnProperty("innerItem")){g(q.innerItem).each(function(t,s){if(s.hasOwnProperty("item")){l(s)}})}})}function d(r,q,p){if(PageMode=="edit"||PageMode=="add"){if(p==undefined){g(k(r,q)).find("[req]:not([requirexd='required'])").attr("required","required").addClass("validatebox-invalid")}else{if(p){if(g(k(r,q)).find("[name][requirexd='required']").length<1){g(k(r,q)).find("[name]:not([requirexd='required'])").attr("required","required").addClass("validatebox-invalid")}}else{g(k(r,q)).find("[required]").removeAttr("required").removeClass("validatebox-invalid").attr("req","required")}}}else{return undefined}}function j(q){var p;if(q==undefined||q==""){p=f(q)}else{p=f("C4-WorkflowStateDisplayName")}if(PageMode=="add"&&(p==undefined||p=="")){return"new"}else{return p}}function i(v,s,t,u){g(s).each(function(w,x){if(v==x.ifValue||v.indexOf(x.ifValue)>=0){k(x.field,x.finder).show();d(x.field,x.finder)}else{k(x.field,x.finder).hide();o(x.field,x.finder);d(x.field,x.finder,false)}});if(t!=undefined){var r=t;var q=true;var p;while(r!=undefined){g(r).each(function(x,w){if(q){if(u){k(w.item,w.finder).hide();o(w.item,w.finder);d(w.item,w.finder,false)}p=f(w.item)}g(w.showSection).each(function(y,z){if(p==z.ifValue||p.indexOf(z.ifValue)>=0){if(q){k(z.field,z.finder).show();d(z.field,z.finder)}}else{k(z.field,z.finder).hide();o(z.field,z.finder);d(z.field,z.finder,false)}});if(v==w.ifValue||v.indexOf(w.ifValue)>=0){if(q){k(w.item,w.finder).show();d(w.item,w.finder)}}else{k(w.item,w.finder).hide();o(w.item,w.finder);d(w.item,w.finder,false)}p=f(w.item)});q=false;r=r[0].innerItem}}}function o(q,p){if(PageMode=="edit"||PageMode=="add"){if(p==undefined||p==""){m(q)}else{g(k(q,p)).find("[name]").each(function(r,s){m(g(s).attr("name"))})}}else{return undefined}}function m(p){switch(n(p)){case"radio":case"checkbox":g(k(p)).find(":checked").removeAttr("checked");if(radiolist!=undefined&&radiolist.indexOf(p)<0){radiolist.push(p)}break;case"text":case"hidden":case"textarea":g(a(p)).val("");break;case"PeoplePicker":g(a(p)).parent().find("span").remove();g(a(p)).val("");g(a(p)).prev().val("");break;case"Richtext":CKEDITOR.instances["Metadata-"+p].setData("");break;case"MultiSelect":case"SingleSelect":g(a(p)).selectpicker("val",[]);if(radiolist!=undefined&&radiolist.indexOf(p)<0){radiolist.push(p)}break;default:return undefined}return true}function a(p){if(PageMode=="edit"||PageMode=="add"){return g("[name='"+p+"']")}else{return undefined}}function k(q,p){switch(p){case"parent":return g("[name='DIV_"+q+"']").parent().parent().parent().parent().parent();case"prev":if(g("[name='DIV_"+q+"']").prev().prev().length<=0){return g("[name='DIV_"+q+"']").parent().prev()}else{return g("[name='DIV_"+q+"']").prev().prev()}case"next":if(g("[name='DIV_"+q+"']").next().next().length<=0){return g("[name='DIV_"+q+"']").parent().next()}else{return g("[name='DIV_"+q+"']").next().next()}default:return g("[name='DIV_"+q+"']")}}function b(p){return JSON.parse(g("#Metadata-"+p+"_relationsvalue").attr("value"))}function n(r){if(r==undefined){return undefined}var t="";if(PageMode=="edit"||PageMode=="add"){var q;var s;if(typeof(r)=="string"){q=g("[name='"+r+"']");s=document.getElementsByName(r)[0]?document.getElementsByName(r)[0].tagName.toLowerCase():""}else{q=g(r);s=q[0]?q[0].tagName.toLowerCase():""}switch(s){case"input":var p=g(q).attr("type");switch(p){case"radio":case"checkbox":case"text":t=p;break;case"hidden":if(g(q).parent(".x_dpBoxWrapper").length>0){t="PeoplePicker"}else{t=p}break;default:if(g(q).parent(".x_dpBoxWrapper").length>0){t="PeoplePicker"}else{t=p}break}break;case"textarea":if(g(q).next().find("iframe").length>0){t="Richtext"}else{t=s}break;case"select":if(g(q).attr("multiple")=="multiple"){t="MultiSelect"}else{t="SingleSelect"}break;case"div":t="div";break;default:return undefined}return t}else{return undefined}}function c(q,p){console.log("setValue "+q+":"+p)}function f(s){if(s==undefined){return""}switch(PageMode){case"preview":if(g("[name='DIV_"+s+"'] div").length<=1){return g("[name='DIV_"+s+"'] div").eq(0).html().trim()}else{return g("[name='DIV_"+s+"'] div").eq(1).html().trim()}case"edit":case"add":switch(n(s)){case"radio":var t=g(k(s)).find(":checked").val();return t?t:"";case"checkbox":var q="";var p=g(k(s)).find(":checked");
if(p.length>0){g(k(s)).find(":checked").each(function(v,u){if(u==0){q=g(v).val()}else{q=q+","+g(v).val()}})}else{q=""}return q;case"text":case"hidden":case"textarea":case"SingleSelect":case"PeoplePicker":return g(a(s)).val();case"Richtext":return CKEDITOR.instances["Metadata-"+s].getData();case"MultiSelect":var r=g(a(s)).val();if(r!=undefined&&r.length>0){return g(a(s)).val().join(",")}else{return""}default:if(g("[name='DIV_"+s+"']").length>0){return g("[name='DIV_"+s+"'] div").eq(1).html().trim()}else{return undefined}}default:return""}}function h(q,p){var q=Math.round(q*Math.pow(10,p))/Math.pow(10,p);return q}})(jQuery);var C4Design=$(this).C4Design;